<!DOCTYPE html>
<html lang="en">
  
<!-- Mirrored from yevgenysim-turkey.github.io/dashbrd/job/job.html by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 30 Nov 2024 08:45:59 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content="A fully featured admin theme which can be used to build CRM, CMS, etc." />

  <style>
    .delete {
      border: 1px solid;
      background: red;
      color: white;
      border-radius: 6px;
      font-size: 12px;
    }


        .progress-ring circle {
            fill: none;
            stroke-width: 10;
        }
        .progress-ring .bg-ring {
            stroke: #e6e6e6;
        }
        .progress-ring .progress-ring-bar {
            stroke: #4caf50;
            transition: stroke-dashoffset 0.3s;
        }
       .percentage-text {
            font-size: 25px;
            text-anchor: middle;
            dominant-baseline: middle;
            fill: #333;
            font-weight: 800;
        }
  </style>
    <!-- Light/dark mode -->
    <script>
      /*!
       * Color mode toggler for Bootstrap's docs (https://getbootstrap.com/)
       * Copyright 2011-2024 The Bootstrap Authors
       * Licensed under the Creative Commons Attribution 3.0 Unported License.
       * Modified by Simpleqode
       */
    
      (() => {
        'use strict';
    
        const getStoredTheme = () => localStorage.getItem('theme');
        const setStoredTheme = (theme) => localStorage.setItem('theme', theme);
    
        const getPreferredTheme = () => {
          const storedTheme = getStoredTheme();
          if (storedTheme) {
            return storedTheme;
          }
    
          return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
        };
    
        const setTheme = (theme) => {
          if (theme === 'auto') {
            document.documentElement.setAttribute('data-bs-theme', window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
          } else {
            document.documentElement.setAttribute('data-bs-theme', theme);
          }
        };
    
        setTheme(getPreferredTheme());
    
        const showActiveTheme = (theme, focus = false) => {
          const themeSwitchers = document.querySelectorAll('[data-bs-theme-switcher]');
    
          themeSwitchers.forEach((themeSwitcher) => {
            const themeSwitcherIcon = themeSwitcher.querySelector('.material-symbols-outlined');
            themeSwitcherIcon.innerHTML = theme === 'light' ? 'light_mode' : theme === 'dark' ? 'dark_mode' : 'contrast';
    
            if (focus) {
              themeSwitcher.focus();
            }
          });
    
          document.querySelectorAll('[data-bs-theme-value]').forEach((element) => {
            element.classList.remove('active');
            element.setAttribute('aria-pressed', 'false');
    
            if (element.getAttribute('data-bs-theme-value') === theme) {
              element.classList.add('active');
              element.setAttribute('aria-pressed', 'true');
            }
          });
        };
    
        const refreshCharts = () => {
          const charts = document.querySelectorAll('.chart-canvas');
    
          charts.forEach((chart) => {
            const chartId = chart.getAttribute('id');
            const instance = Chart.getChart(chartId);
    
            if (!instance) {
              return;
            }
    
            if (instance.options.scales.y) {
              instance.options.scales.y.grid.color = getComputedStyle(document.documentElement).getPropertyValue('--bs-border-color');
              instance.options.scales.y.ticks.color = getComputedStyle(document.documentElement).getPropertyValue('--bs-secondary-color');
            }
    
            if (instance.options.scales.x) {
              instance.options.scales.x.ticks.color = getComputedStyle(document.documentElement).getPropertyValue('--bs-secondary-color');
            }
    
            if (instance.options.elements.arc) {
              instance.options.elements.arc.borderColor = getComputedStyle(document.documentElement).getPropertyValue('--bs-body-bg');
              instance.options.elements.arc.hoverBorderColor = getComputedStyle(document.documentElement).getPropertyValue('--bs-body-bg');
            }
    
            instance.update();
          });
        };
    
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', () => {
          const storedTheme = getStoredTheme();
          if (storedTheme !== 'light' && storedTheme !== 'dark') {
            setTheme(getPreferredTheme());
          }
        });
    
        window.addEventListener('DOMContentLoaded', () => {
          showActiveTheme(getPreferredTheme());
    
          document.querySelectorAll('[data-bs-theme-value]').forEach((toggle) => {
            toggle.addEventListener('click', (e) => {
              e.preventDefault();
              const theme = toggle.getAttribute('data-bs-theme-value');
              setStoredTheme(theme);
              setTheme(theme);
              showActiveTheme(theme, true);
              refreshCharts();
            });
          });
        });
      })();
    </script>
    
    <!-- Favicon -->
    <link rel="shortcut icon" href="../assets/favicon/favicon.html" type="image/x-icon" />
    
    <!-- Fonts and icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com/" />
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&amp;display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,1,0" />
    
    <!-- Libs CSS -->
    <link rel="stylesheet" href="../assets/css/libs.bundle.css" />
    
    <!-- Theme CSS -->
    <link rel="stylesheet" href="../assets/css/theme.bundle.css" />
    
    <!-- Title -->
    <title>Dashbrd</title>
  </head>

  <body>
    <!-- Sidenav -->
    <!-- Sidenav (sm) -->
    <aside class="aside aside-sm d-none d-xl-flex">
      <nav class="navbar navbar-expand-xl navbar-vertical">
        <div class="container-fluid">
          <div class="collapse navbar-collapse" id="sidenavSmallCollapse">
            <!-- Nav -->
            <nav class="navbar-nav nav-pills h-100">
              <div class="nav-item">
                <div data-bs-toggle="tooltip" data-bs-placement="right" data-bs-trigger="hover" data-bs-title="Color mode">
                  <a
                    class="nav-link"
                    data-bs-toggle="collapse"
                    data-bs-theme-switcher
                    href="#colorModeOptions"
                    role="button"
                    aria-expanded="false"
                    aria-controls="colorModeOptions"
                  >
                    <span class="material-symbols-outlined mx-auto"> </span>
                  </a>
                </div>
                <div class="collapse" id="colorModeOptions">
                  <div class="border-top border-bottom py-2">
                    <a
                      class="nav-link fs-sm"
                      data-bs-toggle="tooltip"
                      data-bs-placement="right"
                      data-bs-trigger="hover"
                      data-bs-title="Light"
                      data-bs-theme-value="light"
                      href="#"
                      role="button"
                    >
                      <span class="material-symbols-outlined mx-auto"> light_mode </span>
                    </a>
                    <a
                      class="nav-link fs-sm"
                      data-bs-toggle="tooltip"
                      data-bs-placement="right"
                      data-bs-trigger="hover"
                      data-bs-title="Dark"
                      data-bs-theme-value="dark"
                      href="#"
                      role="button"
                    >
                      <span class="material-symbols-outlined mx-auto"> dark_mode </span>
                    </a>
                    <a
                      class="nav-link fs-sm"
                      data-bs-toggle="tooltip"
                      data-bs-placement="right"
                      data-bs-trigger="hover"
                      data-bs-title="Auto"
                      data-bs-theme-value="auto"
                      href="#"
                      role="button"
                    >
                      <span class="material-symbols-outlined mx-auto"> contrast </span>
                    </a>
                  </div>
                </div>
              </div>
              <div class="nav-item" data-bs-toggle="tooltip" data-bs-placement="right" data-bs-toggle="hover" data-bs-title="Go to product page">
                <a class="nav-link" href="https://themes.getbootstrap.com/product/dashbrd/" target="_blank">
                  <span class="material-symbols-outlined mx-auto"> local_mall </span>
                </a>
              </div>
              <div class="nav-item mt-auto" data-bs-toggle="tooltip" data-bs-placement="right" data-bs-toggle="hover" data-bs-title="Contact us">
                <a class="nav-link" href="mailto:yevgenysim+simpleqode@gmail.com">
                  <span class="material-symbols-outlined mx-auto"> support </span>
                </a>
              </div>
            </nav>
          </div>
        </div>
      </nav>
    </aside>
    
    <!-- Sidenav (lg) -->
    <aside class="aside">
      <nav class="navbar navbar-expand-xl navbar-vertical">
        <div class="container-fluid">
          <!-- Brand -->
          <a class="navbar-brand fs-5 fw-bold px-xl-3 mb-xl-4" href="/">
            <i class="fs-4 text-secondary me-1" data-duoicon="box-2"></i> ETL
          </a>

          <!-- User -->
          <div class="ms-auto d-xl-none">
            <div class="dropdown my-n2">
              <a class="btn btn-link d-inline-flex align-items-center dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                <span class="avatar avatar-sm avatar-status avatar-status-success me-3">
                </span>
                John Williams
              </a>
              <ul class="dropdown-menu dropdown-menu-end">
                <li><a class="dropdown-item" href="#">Account</a></li>
                <li><a class="dropdown-item" href="#">Change password</a></li>
                <li>
                  <hr class="dropdown-divider" />
                </li>
                <li><a class="dropdown-item" href="#">Sign out</a></li>
              </ul>
            </div>
          </div>

          <!-- Toggler -->
          <button
            class="navbar-toggler ms-3"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#sidenavLargeCollapse"
            aria-controls="sidenavLargeCollapse"
            aria-expanded="false"
            aria-label="Toggle navigation"
          >
            <span class="navbar-toggler-icon"></span>
          </button>

          <!-- Collapse -->
          <div class="collapse navbar-collapse" id="sidenavLargeCollapse">
            <!-- Search -->
            <div class="input-group d-xl-none my-4 my-xl-0">
              <input
                class="form-control"
                id="topnavSearchInputMobile"
                type="search"
                placeholder="Search"
                aria-label="Search"
                aria-describedby="navbarSearchMobile"
              />
              <span class="input-group-text" id="navbarSearchMobile">
                <span class="material-symbols-outlined"> search </span>
              </span>
            </div>

            <!-- Nav -->
            <nav class="navbar-nav nav-pills mb-7">
              <div class="nav-item">
                <a
                                class="nav-link"
                                href="/"
                        >
                            <span class="material-symbols-outlined me-3">space_dashboard</span> Dashboards
                        </a>
                <div class="collapse" id="dashboards">
                  <nav class="nav nav-pills">
                    <a class="nav-link" href="index.html">Default</a>
                    <a class="nav-link " href="dashboards/crypto.html">Crypto</a>
                    <a class="nav-link " href="dashboards/saas.html">SaaS</a>
                  </nav>
                </div>
              </div>

              <div class="nav-item">
                <a
                  class="nav-link active"
                  href="#"
                  data-bs-toggle="collapse"
                  data-bs-target="#projects"
                  rol="button"
                  aria-expanded="false"
                  aria-controls="projects"
                >
                  <span class="material-symbols-outlined me-3">list_alt</span> Jobs Management
                </a>
                <div class="collapse show" id="projects">
                  <nav class="nav nav-pills">
<!--                    <a class="nav-link " href="/jobs">External Datasets</a>-->
                    <a class="nav-link active" href="/job/running">Success / Failed Jobs</a>
                    <a class="nav-link " href="/job/new">New Job</a>
                  </nav>
                </div>
              </div>

            </nav>


            <!-- Divider -->
            <hr class="my-4 d-xl-none" />

            <!-- Nav -->
            <nav class="navbar-nav nav-pills d-xl-none mb-7">
              <div class="nav-item">
                <a
                  class="nav-link"
                  data-bs-toggle="collapse"
                  data-bs-theme-switcher
                  href="#colorModeOptionsMobile"
                  role="button"
                  aria-expanded="false"
                  aria-controls="colorModeOptionsMobile"
                >
                  <span class="material-symbols-outlined me-3"> </span> Color mode
                </a>
                <div class="collapse" id="colorModeOptionsMobile">
                  <div class="nav nav-pills">
                    <a class="nav-link" data-bs-theme-value="light" href="#" role="button"> Light </a>
                    <a class="nav-link" data-bs-theme-value="dark" href="#" role="button"> Dark </a>
                    <a class="nav-link" data-bs-title="Auto" data-bs-theme-value="auto" href="#" role="button"> Auto </a>
                  </div>
                </div>
              </div>
              <div class="nav-item">
                <a class="nav-link" href="https://themes.getbootstrap.com/product/dashbrd/" target="_blank">
                  <span class="material-symbols-outlined me-3">local_mall</span> Go to product page
                </a>
              </div>
              <div class="nav-item">
                <a class="nav-link" href="mailto:yevgenysim+simpleqode@gmail.com">
                  <span class="material-symbols-outlined me-3">alternate_email</span> Contact us
                </a>
              </div>
            </nav>

            <!-- Card -->
            <div class="card mt-auto">

            </div>
          </div>
        </div>
      </nav>
    </aside>
    <!-- Topnav -->
    <nav class="navbar d-none d-xl-flex px-xl-6">
      <div class="container flex-column align-items-stretch">
        <div class="row">
          <div class="col">
            <!-- Search -->
            <div class="input-group" style="max-width: 400px">
              <input class="form-control" id="topnavSearchInput" type="search" placeholder="Search" aria-label="Search" aria-describedby="navbarSearch" />
              <span class="input-group-text" id="navbarSearch">
                <kbd class="badge bg-body-secondary text-body">⌘</kbd>
                <kbd class="badge bg-body-secondary text-body ms-1">K</kbd>
              </span>
            </div>
          </div>
          <div class="col-auto">
            <!-- User -->
            <div class="dropdown my-n2">
              <a class="btn btn-link d-inline-flex align-items-center dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                <span class="avatar avatar-sm avatar-status avatar-status-success me-3">
                  <img class="avatar-img" src="../assets/img/photos/photo-6.jpg" alt="..." />
                </span>
                John Williams
              </a>
              <ul class="dropdown-menu dropdown-menu-end">
                <li><a class="dropdown-item" href="#">Account</a></li>
                <li><a class="dropdown-item" href="#">Change password</a></li>
                <li>
                  <hr class="dropdown-divider" />
                </li>
                <li><a class="dropdown-item" href="#">Sign out</a></li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </nav>

    <!-- Main -->
    <main class="main px-lg-6">
      <!-- Content -->
      <div class="container-lg">
        <!-- Page header -->
        <div class="row align-items-center mb-7">
          <div class="col-auto">
            <!-- Avatar -->
            <div class="avatar avatar-xl rounded text-primary">
              <i class="fs-2" data-duoicon="clipboard"></i>
            </div>
          </div>
          <div class="col">
            <!-- Breadcrumb -->
            <nav aria-label="breadcrumb">
              <ol class="breadcrumb mb-2">
                <li class="breadcrumb-item"><a class="text-body-secondary" href="#">Celery Jobs</a></li>
                <li class="breadcrumb-item active" aria-current="page">Tasks</li>
              </ol>
            </nav>

            <!-- Heading -->
            <h1 class="fs-4 mb-0">Jobs (Success / Failed / In Progress) </h1>
          </div>
          <div class="col-12 col-sm-auto mt-4 mt-sm-0">
            <!-- Action -->
            <a class="btn btn-secondary d-block" href="/job/new"> <span class="material-symbols-outlined me-1">add</span> Create Job </a>
          </div>
        </div>

        <!-- Page content -->
        <div class="row">
          <div class="col-12">
            <!-- Filters -->

            <!-- Table -->
            <div class="table-responsive mb-7">
              <table class="table table-selectable align-middle mb-0">
                <thead>

                  <th style="color: black;font-weight: 500;">Name</th>
                  <th style="color: black;font-weight: 500;">Status</th>
                  <th style="color: black;font-weight: 500;">Queue Time</th>
                  <th style="color: black;font-weight: 500;">State</th>
                  <th style="color: black;font-weight: 500;">Progress</th>
                  <th style="color: black;font-weight: 500;">Action</th>
                </thead>
                <tbody>
                {% if data %}
                    {% for task in data %}
                        <tr>

                            <td>
                              {% for dataset in task.datasets %}
                                  {{ dataset.name }}
                              {% endfor %}
                            </td> <!-- Replace 'task_id' with the appropriate key in task.to_dict() -->
                            <td>{{ task.status }}</td>
                            <td>
                              {{task.created_at}}
                            </td>
                            <td></td>
                            <td>
                              <div class="progress-ring" style="width: 50px; height: 50px;">
                                  <svg width="100%" height="100%" viewBox="0 0 120 120">
                                      <circle class="bg-ring" cx="60" cy="60" r="50"></circle>
                                      <circle class="progress-ring-bar" cx="60" cy="60" r="50" stroke-dasharray="314" stroke-dashoffset="0"></circle>
                                      <text class="percentage-text" x="50%" y="50%" id="percentage-{{ task.id }}">{{ task.progress }}%</text>
                                  </svg>
                              </div>
                            </td>
                            <td>
                              <button class="btn btn-sm btn-light delete" onclick="deletetask('{{ task.task_id }}')">
                                <span class="material-symbols-outlined text-body-secondary me-1">delete</span>
                                Delete
                              </button>
                              <a class="btn btn-sm btn-light" href="/job/running/dataset/{{task.task_id}}?page=1&limit=8">
                                <span class="material-symbols-outlined text-body-secondary me-1">open_in_new</span>
                                  Open
                              </a>
                            </td>
                        </tr>
                    {% endfor %}
                {% else %}
                    <tr>
                        <td colspan="6" class="text-center">No tasks found</td>
                    </tr>
                {% endif %}

                </tbody>
              </table>
            </div>
          </div>
        </div>

      </div>
    </main>

    <script>


      function deletetask(taskId) {
        const userConfirmed = confirm("Are you sure you want to delete this task? " + taskId);

        if (userConfirmed) {
          const formData = new FormData();
          formData.append("task_id", taskId);

          fetch("http://127.0.0.1:5000/api/etl/extract", {
            method: "DELETE",
            body: formData,
          })
            .then(response => {
              if (response.ok) {
                alert("Task deleted successfully!");
                location.reload();
              } else {
                response.json().then(data => {
                  alert(`Failed to delete task: ${data.message || "Unknown error"}`);
                });
              }
            })
            .catch(error => {
              console.error("Error while deleting the task:", error);
              alert("An error occurred while trying to delete the task.");
            });
        }
      }

       const progressRingBar = document.querySelector('.progress-ring .progress-ring-bar');
        const percentageText = document.getElementById('percentage');
        const input = document.getElementById('progressInput');

        const radius = 50;
        const circumference = 2 * Math.PI * radius;

        function setProgress(percentage) {
            const offset = circumference - (percentage / 100) * circumference;
            progressRingBar.style.strokeDashoffset = offset;
            percentageText.textContent = `${percentage}%`;
        }

        function updateProgress() {
            const progress = parseInt(input.value);
            if (!isNaN(progress) && progress >= 0 && progress <= 100) {
                setProgress(progress);
            } else {
                alert('Please enter a valid percentage between 0 and 100.');
            }
        }


      document.addEventListener("DOMContentLoaded", function() {
            // Loop through all task progress elements and update each one
            const tasks = document.querySelectorAll('.progress-ring');
            tasks.forEach(function(task) {
                const progress = task.querySelector('.percentage-text').textContent.replace('%', '');
                const progressRingBar = task.querySelector('.progress-ring-bar');
                const radius = 50;
                const circumference = 2 * Math.PI * radius;
                const offset = circumference - (progress / 100) * circumference;

                // Update stroke-dashoffset based on progress
                progressRingBar.style.strokeDashoffset = offset;
            });
        });


    </script>

    <script src="../assets/js/vendor.bundle.js"></script>
    <script src="../assets/js/theme.bundle.js"></script>
  </body>
</html>
